#!/bin/bash

#SBATCH --job-name=20_keep_species
#SBATCH --partition=carl.p
#SBATCH --array=1-2
#SBATCH --output=/user/doau0129/work/chapter1_2//logs/20_keep_species_%A_%a.out
#SBATCH --error=/user/doau0129/work/chapter1_2//logs/20_keep_species_%A_%a.err
#SBATCH --nodes=1
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=1
#SBATCH --mem-per-cpu=20G
#SBATCH --time=02:30:00

INPUT_VCF=/user/doau0129/work/chapter1_2//outputs/09_1_snpfiltration/filterd_bi-allelic.vcf.gz
echo ${INPUT_VCF}

tr=(nig pue)
printf "%s\n" "${tr[@]}" > /user/doau0129/work/chapter1_2//outputs/listoffiles/fst_species.fofn

INPUT_SP=/user/doau0129/work/chapter1_2//outputs/listoffiles/fst_species.fofn
SP=$(cat ${INPUT_SP} | head -n ${SLURM_ARRAY_TASK_ID} | tail -n 1)
echo ${SP}

if [ "${SP}" = "nig" ];
then
  vcfsamplenames ${INPUT_VCF} |        grep ${SP} > /user/doau0129/work/chapter1_2//outputs/fst/${SP}.pop
fi



if [ "${SP}" = "pue" ];
then
  vcfsamplenames ${INPUT_VCF} |         grep ${SP} |         grep -v unipue |         grep -v tanpue |         grep -v indpue |         grep -v gutpue |         grep -v chlpue |         grep -v abe pue |         grep -v nigpue > /user/doau0129/work/chapter1_2//outputs/fst/${SP}.pop
fi


vcftools --gzvcf ${INPUT_VCF}       --keep /user/doau0129/work/chapter1_2//outputs/fst/${SP}.pop       --mac 3       --recode       --stdout | gzip > /user/doau0129/work/chapter1_2//outputs/fst/${SP}.vcf.gz

