#!/bin/bash

#SBATCH --job-name=12_prep_gemma.tmp
#SBATCH --partition=carl.p
#SBATCH --output=/user/doau0129/work/chapter1_2//logs/12_prep_gemma_%A_%a.out
#SBATCH --error=/user/doau0129/work/chapter1_2//logs/12_prep_gemma_%A_%a.err
#SBATCH --nodes=1
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=1
#SBATCH --mem-per-cpu=500M
#SBATCH --time=00:15:00


#sed 's/PL17_35puepue/PL17_35indpue/g' /user/doau0129/work/chapter1_2//outputs/gxp/GxP_plink_binary.fam > /user/doau0129/work/chapter1_2//outputs/gxp/GxP_plink_binary1.fam
#mv /user/doau0129/work/chapter1_2//outputs/gxp/GxP_plink_binary1.fam /user/doau0129/work/chapter1_2//outputs/gxp/GxP_plink_binary.fam


fam=/user/doau0129/work/chapter1_2//outputs/gxp/GxP_plink_binary.fam
pheno=/user/doau0129/work/chapter1_2//metadata/traits2

tr=(bhead bbody snout ped gum uni pue nig ind tan chl gut abe may gem flo ran combo_spec)
printf "%s\n" "${tr[@]}" > /user/doau0129/work/chapter1_2//outputs/listoffiles/traits.fofn

#Create joint phenotype and .fam file with all phenotypes
awk -F ";" '{print $1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11,$12,$13,$14,$15,$16,$17,$18,$19}' ${pheno} > /user/doau0129/work/chapter1_2//outputs/gxp/pheno_intermediate1
sort -k1 /user/doau0129/work/chapter1_2//outputs/gxp/pheno_intermediate1 > /user/doau0129/work/chapter1_2//outputs/gxp/pheno_intermediate2
join ${fam} /user/doau0129/work/chapter1_2//outputs/gxp/pheno_intermediate2 > /user/doau0129/work/chapter1_2//outputs/gxp/pheno_intermediate3
awk -F " " '{print $1,$2,$3,$4,$5,$7,$8,$9,$10,$11,$12,$13,$14,$15,$16,$17,$18,$19,$20,$21,$22,$23,$24}' /user/doau0129/work/chapter1_2//outputs/gxp/pheno_intermediate3 > /user/doau0129/work/chapter1_2//outputs/gxp/pheno_intermediate4
echo -e 'label Within_family_ID ID_father ID_mother Sex bhead bbody snout ped gum uni pue nig ind tan chl gut abe may gem flo ran combo_spec' > /user/doau0129/work/chapter1_2//outputs/gxp/pheno_table.fam && cat /user/doau0129/work/chapter1_2//outputs/gxp/pheno_intermediate4 >> /user/doau0129/work/chapter1_2//outputs/gxp/pheno_table.fam


