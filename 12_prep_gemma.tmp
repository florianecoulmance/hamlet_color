#!/bin/bash

#SBATCH --job-name=12_prep_gemma.tmp
#SBATCH --partition=carl.p
#SBATCH --output=/user/doau0129/work/chapter1_2//logs/12_prep_gemma_%A_%a.out
#SBATCH --error=/user/doau0129/work/chapter1_2//logs/12_prep_gemma_%A_%a.err
#SBATCH --nodes=1
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=1
#SBATCH --mem-per-cpu=500M
#SBATCH --time=00:15:00

fam=/user/doau0129/work/chapter1_2//outputs/gxp/GxP_plink_binary.fam
pheno=/user/doau0129/work/chapter1_2//metadata/traits
sed -i 's/PL17_125ranbel/PL17_125tanbel/g' ${fam}

tr=(bars_head bars_body snout peduncle H.gummiguta H.unicolor H.puella H.nigricans H.indigo Tan.hamlet H.chlorurus H.guttavarius H.aberrans H.maya H.gemma H.floridae H.randallorum)
printf "%s\n" "${tr[@]}" > /user/doau0129/work/chapter1_2//outputs/listoffiles/traits.fofn

#Create joint phenotype and .fam file with all phenotypes
awk -F ";" '{print $2,$3,$4,$5,$6,$7,$8,$9,$10,$11,$12,$13,$14,$15,$16,$17,$18,$19,$20,$21,$22}' ${pheno} > /user/doau0129/work/chapter1_2//outputs/gxp/pheno_intermediate1
sort -k1 /user/doau0129/work/chapter1_2//outputs/gxp/pheno_intermediate1 > /user/doau0129/work/chapter1_2//outputs/gxp/pheno_intermediate2
join ${fam} /user/doau0129/work/chapter1_2//outputs/gxp/pheno_intermediate2 > /user/doau0129/work/chapter1_2//outputs/gxp/pheno_intermediate3
awk -F " " '{print $1,$2,$3,$4,$5,$10,$11,$12,$13,$14,$15,$16,$17,$18,$19,$20,$21,$22,$23,$24,$25,$26,$27}' /user/doau0129/work/chapter1_2//outputs/gxp/pheno_intermediate3 > /user/doau0129/work/chapter1_2//outputs/gxp/pheno_intermediate4
echo -e 'label Within_family_ID ID_father ID_mother Sex bars_head bars_body snout peduncle H.gummiguta H.unicolor H.puella H.nigricans H.indigo Tan.hamlet H.chlorurus H.guttavarius H.aberrans H.maya H.gemma H.floridae H.randallorum' > /user/doau0129/work/chapter1_2//outputs/gxp/pheno_table.fam && cat /user/doau0129/work/chapter1_2//outputs/gxp/pheno_intermediate4 >> /user/doau0129/work/chapter1_2//outputs/gxp/pheno_table.fam


