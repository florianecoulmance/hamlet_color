#!/bin/bash

#SBATCH --job-name=24_pairwise_fst
#SBATCH --partition=carl.p
#SBATCH --array=1-12
#SBATCH --output=/user/doau0129/work/chapter1_2//logs/24_pairwise_fst_%A_%a.out
#SBATCH --error=/user/doau0129/work/chapter1_2//logs/24_pairwise_fst_%A_%a.err
#SBATCH --nodes=1
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=1
#SBATCH --mem-per-cpu=32G
#SBATCH --time=04:30:00

INPUT_PW=/user/doau0129/work/chapter1_2//outputs/listoffiles/fst_pairwise.fofn
PW=$(cat ${INPUT_PW} | head -n ${SLURM_ARRAY_TASK_ID} | tail -n 1)
echo ${PW}

SP=$(cut -d' ' -f1 <<< $PW)
LOC1=$(cut -d' ' -f2 <<< $PW)
LOC2=$(cut -d' ' -f3 <<< $PW)
echo ${SP}
echo ${LOC1}
echo ${LOC2}

POP=/user/doau0129/work/chapter1_2//outputs/fst/${SP}.pop
echo ${POP}

VCF=/user/doau0129/work/chapter1_2//outputs/fst/${SP}.vcf.gz
echo ${VCF}


grep ${LOC1} ${POP} > /user/doau0129/work/chapter1_2//outputs/fst/${SP}_${LOC1}_${LOC2}_pop1.txt
grep ${LOC2} ${POP} > /user/doau0129/work/chapter1_2//outputs/fst/${SP}_${LOC1}_${LOC2}_pop2.txt

vcftools --gzvcf        --weir-fst-pop /user/doau0129/work/chapter1_2//outputs/fst/${SP}_${LOC1}_${LOC2}_pop1.txt       --weir-fst-pop /user/doau0129/work/chapter1_2//outputs/fst/${SP}_${LOC1}_${LOC2}_pop2.txt       --fst-window-step 5000       --fst-window-size 50000       --stdout 2> /user/doau0129/work/chapter1_2//outputs/fst/${SP}_${LOC1}_${LOC2}.50k.log |       gzip > /user/doau0129/work/chapter1_2//outputs/fst/${SP}_${LOC1}_${LOC2}.50k.windowed.weir.fst

  vcftools --gzvcf        --weir-fst-pop pop1.txt       --weir-fst-pop pop2.txt       --fst-window-size 10000       --fst-window-step 1000       --stdout 2> /user/doau0129/work/chapter1_2//outputs/fst/${SP}_${LOC1}_${LOC2}.10k.log |       gzip > /user/doau0129/work/chapter1_2//outputs/fst/${SP}_${LOC1}_${LOC2}.10k.windowed.weir.fst


