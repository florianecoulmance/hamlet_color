#!/bin/bash

#SBATCH --job-name=22_multi
#SBATCH --partition=carl.p
#SBATCH --output=/user/doau0129/work/chapter1_2//logs/22_multi_%A_%a.out
#SBATCH --error=/user/doau0129/work/chapter1_2//logs/22_multi_%A_%a.err
#SBATCH --nodes=1
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=1
#SBATCH --mem-per-cpu=20G
#SBATCH --time=15:00:00

INPUT_VCF=/user/doau0129/work/chapter1_2//outputs/09_1_snpfiltration/filterd_bi-allelic.vcf.gz
echo ${INPUT_VCF}


INPUT_POP=/user/doau0129/work/chapter1_2//outputs/fst/hamlets.pop.txt
echo ${INPUT_POP}

awk '{print $1"\t"$2$3}' ${INPUT_POP} > pop.txt

for k in abebel abeboc abepue chlpue floflo gemflo gumboc gutpue indbel indpue maybel nigbel nigboc nigflo nigpue puebel pueboc pueflo puepue ranbel tanpue uniboc uniflo unipue; do
  grep $k pop.txt | cut -f 1 > pop.$k.txt
  done


POP="--weir-fst-pop pop.abebel.txt    --weir-fst-pop pop.abeboc.txt    --weir-fst-pop pop.abepue.txt    --weir-fst-pop pop.chlpue.txt    --weir-fst-pop pop.floflo.txt    --weir-fst-pop pop.gemflo.txt    --weir-fst-pop pop.gumboc.txt    --weir-fst-pop pop.gutpue.txt    --weir-fst-pop pop.indbel.txt    --weir-fst-pop pop.indpue.txt    --weir-fst-pop pop.maybel.txt    --weir-fst-pop pop.nigbel.txt    --weir-fst-pop pop.nigboc.txt    --weir-fst-pop pop.nigflo.txt   --weir-fst-pop pop.nigpue.txt   --weir-fst-pop pop.puebel.txt   --weir-fst-pop pop.pueboc.txt   --weir-fst-pop pop.pueflo.txt   --weir-fst-pop pop.puepue.txt   --weir-fst-pop pop.ranbel.txt   --weir-fst-pop pop.tanpue.txt   --weir-fst-pop pop.uniboc.txt   --weir-fst-pop pop.uniflo.txt   --weir-fst-pop pop.unipue.txt" 


  # fst by SNP
     # ----------
vcftools --gzvcf ${INPUT_VCF}       $POP      --stdout  2> multi_fst_snp.log |      gzip > /user/doau0129/work/chapter1_2//outputs/fst/multi_fst.tsv.gz

     # fst 50kb window
     # ---------------
vcftools --gzvcf ${INPUT_VCF}       $POP      --fst-window-step 5000      --fst-window-size 50000      --stdout  2> multi_fst.50k.log |      gzip > /user/doau0129/work/chapter1_2//outputs/fst/multi_fst.50k.tsv.gz

     # fst 10kb window
     # ---------------
vcftools --gzvcf ${INPUT_VCF}       $POP      --fst-window-step 1000      --fst-window-size 10000      --stdout  2> multi_fst.10k.log |      gzip > /user/doau0129/work/chapter1_2//outputs/fst/multi_fst_snp.tsv.gz  

